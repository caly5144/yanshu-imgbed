# yanshu-imgbed - 一款强大的多后端图床程序

yanshu-imgbed 是一个使用 Go 语言和 Gin 框架构建的高性能、多后端的图床应用程序。它支持将图片分发到多个存储后端，并提供了灵活的访问策略和完善的后台管理功能。

 \#\# ✨ 功能特性

  * **用户认证系统**: 基于 JWT 的安全用户认证，支持管理员和普通用户角色。
  * **多后端存储**:
      * 支持**本地服务器**存储和 **SM.MS** 图床作为存储后端。
      * 后续会支持更多第三方云存储。
  * **重复图片检测**: 上传时通过计算文件 MD5 哈希值，自动识别已存在的图片，避免冗余存储。
  * **灵活的访问策略**:
      * 支持**随机 (Random)** 和**优先级 (Priority)** 两种图片访问策略。
      * 配置可在后台动态修改，实时生效。
  * **智能健康检查**:
      * 访问图片时自动检查存储链接的有效性。
      * 对访问失败的存储位置记录失败次数，并在达到阈值后自动将其标记为对该图片失效。
  * **强大的后台管理**:
      * **概览页面**: 可视化展示图片总数、占用空间、后端数量和当日上传量。
      * **图片管理**: 集中管理所有图片，支持搜索、批量删除、批量补传和查看详情。
      * **后端管理**: 动态添加、编辑和删除存储后端，可独立控制后端的“允许上传”和“允许跳转”状态。
      * **用户管理**: 管理员可以创建、删除用户和重置用户密码。
      * **系统设置**: 在线修改访问策略、失败重试次数等核心配置。
  * **API 支持**:
      * 支持为用户生成 API Token，用于通过 API 上传图片。
      * 提供独立的 API 上传接口。

## 🛠️ 技术栈

  * **后端**: Go, Gin
  * **数据库**: SQLite (通过 GORM)
  * **配置管理**: Viper
  * **前端**: 原生 HTML, CSS, JavaScript

## 🚀 快速开始

### 环境要求

  * Go 1.18 或更高版本

### 安装与运行

1.  **克隆仓库**

    ```bash
    git clone https://github.com/your-username/gin-image-bed.git
    cd gin-image-bed
    ```

2.  **安装依赖**

    ```bash
    go mod tidy
    ```

3.  **配置**
    复制或重命名 `config.yml` 文件。您可以根据需要修改其中的配置：

    ```yaml
    server:
      port: "8080" # 应用运行端口

    database:
      dsn: "image_bed.db" # 数据库文件名

    jwt:
      secret: "your-super-secret-key" # 请务必修改为一个强随机字符串
      expiration_hours: 24
    ```

4.  **运行程序**

    ```bash
    go run main.go
    ```

    程序启动后，会在当前目录下自动创建 `image_bed.db` 数据库文件和 `uploads` 文件夹（用于本地存储）。

### 访问与使用

  * **主页 (上传)**: `http://127.0.0.1:8080/`
  * **登录页**: `http://127.0.0.1:8080/login`
  * **管理后台**: `http://127.0.0.1:8080/admin`

**默认管理员账户**:

  * **用户名**: `admin`
  * **密码**: `admin123`

## 📝 API 端点概览

程序提供了一系列 API 接口用于程序化交互。所有受保护的接口都需要 `Authorization: Bearer <JWT_TOKEN>` 请求头。

  * `POST /auth/login`: 用户登录
  * `POST /api/upload/web`: (需要JWT认证) 网页端上传文件
  * `POST /api/upload/api`: (需要API Token认证) API客户端上传文件
  * `GET /i/:uuid`: 访问/跳转到图片
  * `GET /api/admin/images`: (管理员) 获取图片列表
  * `GET /api/admin/backends/all`: (管理员) 获取所有后端列表

更多接口定义请参考 `router/router.go` 文件。

## 📄 许可证

本项目采用 MIT 许可证。